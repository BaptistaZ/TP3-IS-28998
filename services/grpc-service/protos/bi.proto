syntax = "proto3";

package bi;

service BIService {
  rpc ListDocs (ListDocsRequest) returns (ListDocsResponse);
  rpc QueryAssets (QueryAssetsRequest) returns (QueryAssetsResponse);
  rpc CategoryAgg (CategoryAggRequest) returns (CategoryAggResponse);
}

message ListDocsRequest {
  int32 limit = 1;
}

message Doc {
  int32 id = 1;
  string mapper_version = 2;
  string created_at = 3;
}

message ListDocsResponse {
  repeated Doc docs = 1;
}

message QueryAssetsRequest {
  string ticker = 1;     
  string category = 2;   
  int32 limit = 3;
}

message Asset {
  int32 doc_id = 1;
  string internal_id = 2;
  string ticker = 3;
  string category = 4;
  double price_eur = 5;
  double price_usd = 6;
  double volume = 7;
  double fx_eur_usd = 8;
  string processed_at_utc = 9;
}

message QueryAssetsResponse {
  repeated Asset assets = 1;
}

message CategoryAggRequest {}

message CategoryAggRow {
  string category = 1;
  int32 total_assets = 2;
  double total_volume = 3;
  double avg_price_eur = 4;
  double avg_price_usd = 5;
}

message CategoryAggResponse {
  repeated CategoryAggRow rows = 1;
}